- content_for :title, t('admin.passwords.edit', default: 'Change Password')

= render Admin::PageHeaderComponent.new(title: t('admin.passwords.edit', default: 'Change Password'), subtitle: t('admin.passwords.edit_subtitle', default: 'Update your password'), icon: 'lock')

.bg-white.shadow.rounded-lg.p-6
  - if current_user.force_password_change?
    .bg-amber-50.border.border-amber-200.rounded-md.p-4.mb-6
      .flex
        = lucide_icon('alert-triangle', class: 'w-5 h-5 text-amber-600 mr-3 flex-shrink-0 mt-0.5')
        .div
          %h3.text-sm.font-medium.text-amber-800
            = t('admin.passwords.force_change_notice', default: 'Password change required')
          %p.mt-1.text-sm.text-amber-700
            = t('admin.passwords.force_change_message', default: 'Your password has been reset. Please choose a new password to continue.')

  = form_with model: current_user, url: admin_password_path, method: :patch, local: true do |f|
    .space-y-6
      - if current_user.errors.any?
        .bg-red-50.border.border-red-200.rounded-md.p-4
          .flex
            = lucide_icon('alert-circle', class: 'w-5 h-5 text-red-400 mr-3 flex-shrink-0 mt-0.5')
            .div
              %h3.text-sm.font-medium.text-red-800
                = t('admin.passwords.form.errors', count: current_user.errors.count, default: 'There were some errors with your submission')
              .mt-2.text-sm.text-red-700
                %ul.list-disc.list-inside
                  - current_user.errors.full_messages.each do |message|
                    %li= message

      / Current password field
      .div{data: { controller: "password-visibility" }}
        = f.label :current_password, t('admin.passwords.form.current_password', default: 'Current Password'), class: 'block text-sm font-medium text-gray-700 mb-2'
        .relative
          = f.password_field :current_password, class: 'mt-1 block w-full pr-10 rounded-md border-gray-300 shadow-sm focus:border-[#FA812F] focus:ring-[#FA812F] sm:text-sm', placeholder: t('admin.passwords.form.current_password_placeholder', default: 'Enter your current password'), required: true, autocomplete: 'current-password', data: { password_visibility_target: "input" }
          = button_tag type: "button", class: "absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 focus:outline-none", data: { action: "password-visibility#toggle" } do
            %span{ data: { password_visibility_target: "eyeOpen" } }= lucide_icon('eye', class: 'w-5 h-5')
            %span.hidden{ data: { password_visibility_target: "eyeClosed" } }= lucide_icon('eye-off', class: 'w-5 h-5')
        %p.mt-1.text-sm.text-gray-500= t('admin.passwords.form.current_password_help', default: 'Enter your current password to confirm your identity')

      .grid.grid-cols-1.md_grid-cols-2.gap-6
        / New password field
        .div{data: { controller: "password-visibility" }}
          = f.label :password, t('admin.passwords.form.new_password', default: 'New Password'), class: 'block text-sm font-medium text-gray-700 mb-2'
          .relative
            = f.password_field :password, class: 'mt-1 block w-full pr-10 rounded-md border-gray-300 shadow-sm focus:border-[#FA812F] focus:ring-[#FA812F] sm:text-sm', placeholder: t('admin.passwords.form.new_password_placeholder', default: 'Enter new password'), required: true, autocomplete: 'new-password', data: { password_visibility_target: "input" }
            = button_tag type: "button", class: "absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 focus:outline-none", data: { action: "password-visibility#toggle" } do
              %span{ data: { password_visibility_target: "eyeOpen" } }= lucide_icon('eye', class: 'w-5 h-5')
              %span.hidden{ data: { password_visibility_target: "eyeClosed" } }= lucide_icon('eye-off', class: 'w-5 h-5')
          %p.mt-1.text-sm.text-gray-500= t('admin.passwords.form.password_help', default: 'Minimum 6 characters')

        / New password confirmation field
        .div{data: { controller: "password-visibility" }}
          = f.label :password_confirmation, t('admin.passwords.form.password_confirmation', default: 'Confirm New Password'), class: 'block text-sm font-medium text-gray-700 mb-2'
          .relative
            = f.password_field :password_confirmation, class: 'mt-1 block w-full pr-10 rounded-md border-gray-300 shadow-sm focus:border-[#FA812F] focus:ring-[#FA812F] sm:text-sm', placeholder: t('admin.passwords.form.password_confirmation_placeholder', default: 'Confirm new password'), required: true, autocomplete: 'new-password', data: { password_visibility_target: "input" }
            = button_tag type: "button", class: "absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 focus:outline-none", data: { action: "password-visibility#toggle" } do
              %span{ data: { password_visibility_target: "eyeOpen" } }= lucide_icon('eye', class: 'w-5 h-5')
              %span.hidden{ data: { password_visibility_target: "eyeClosed" } }= lucide_icon('eye-off', class: 'w-5 h-5')

      / Action buttons
      .flex.items-center.justify-end.gap-3.pt-5.border-t.border-gray-200
        - unless current_user.force_password_change?
          = link_to t('admin.passwords.form.cancel', default: 'Cancel'), admin_root_path, class: 'px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#FA812F]'
        = f.submit t('admin.passwords.form.submit', default: 'Update Password'), class: 'inline-flex justify-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-[#FA812F] hover:bg-[#E87020] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#FA812F]'