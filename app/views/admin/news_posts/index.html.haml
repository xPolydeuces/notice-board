- content_for :title, t('admin.news_posts.title')

= render Admin::PageHeaderComponent.new(title: t('admin.news_posts.title'), subtitle: t('admin.news_posts.subtitle'), icon: 'newspaper') do
  = link_to new_admin_news_post_path, class: "inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-[#FA812F] hover:bg-[#E87020] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#FA812F]" do
    = lucide_icon('plus', class: 'w-4 h-4 mr-2')
    = t('admin.news_posts.new')

/ Filters section
- if current_user.admin_or_superadmin?
  .bg-white.shadow.rounded-lg.p-3.sm:p-4.mb-4.sm:mb-6
    = form_with url: admin_news_posts_path, method: :get, local: true, class: "grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4" do |f|
      .div
        = label_tag :location_id, t('admin.news_posts.filters.location'), class: 'block text-sm font-medium text-gray-700 mb-1'
        = select_tag :location_id, options_from_collection_for_select(@locations, :id, :full_name, params[:location_id]), include_blank: t('admin.news_posts.filters.all_locations'), class: 'block w-full py-2 rounded-md border-gray-300 shadow-sm focus:border-[#FA812F] focus:ring-[#FA812F] sm:text-sm'

      .div
        = label_tag :published, t('admin.news_posts.filters.published'), class: 'block text-sm font-medium text-gray-700 mb-1'
        = select_tag :published, options_for_select([[t('admin.news_posts.filters.all'), ''], [t('admin.news_posts.filters.published_yes'), 'true'], [t('admin.news_posts.filters.published_no'), 'false']], params[:published]), class: 'block w-full py-2 rounded-md border-gray-300 shadow-sm focus:border-[#FA812F] focus:ring-[#FA812F] sm:text-sm'

      .div
        = label_tag :archived, t('admin.news_posts.filters.archived'), class: 'block text-sm font-medium text-gray-700 mb-1'
        = select_tag :archived, options_for_select([[t('admin.news_posts.filters.all'), ''], [t('admin.news_posts.filters.archived_yes'), 'true'], [t('admin.news_posts.filters.archived_no'), 'false']], params[:archived]), class: 'block w-full py-2 rounded-md border-gray-300 shadow-sm focus:border-[#FA812F] focus:ring-[#FA812F] sm:text-sm'

      .flex.flex-col.sm:flex-row.items-stretch.sm:items-end.gap-2.sm:col-span-2.lg:col-span-1
        = submit_tag t('admin.news_posts.filters.apply'), class: 'inline-flex items-center justify-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-[#FA812F] hover:bg-[#E87020] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#FA812F]'
        = link_to t('admin.news_posts.filters.clear'), admin_news_posts_path, class: 'inline-flex items-center justify-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#FA812F]'

/ News posts table
.bg-white.shadow.rounded-lg.overflow-hidden
  .overflow-x-auto
    %table.min-w-full.divide-y.divide-gray-200
      %thead.bg-gray-50
        %tr
          %th.px-3.sm:px-6.py-3.text-left.text-xs.font-medium.text-gray-500.uppercase.tracking-wider
          = t('admin.news_posts.table.title')
          %th.px-3.sm:px-6.py-3.text-left.text-xs.font-medium.text-gray-500.uppercase.tracking-wider
            = t('admin.news_posts.table.type')
          - if current_user.admin_or_superadmin?
            %th.px-3.sm:px-6.py-3.text-left.text-xs.font-medium.text-gray-500.uppercase.tracking-wider
              = t('admin.news_posts.table.location')
          %th.px-3.sm:px-6.py-3.text-left.text-xs.font-medium.text-gray-500.uppercase.tracking-wider
            = t('admin.news_posts.table.author')
          %th.px-3.sm:px-6.py-3.text-left.text-xs.font-medium.text-gray-500.uppercase.tracking-wider
            = t('admin.news_posts.table.status')
          %th.px-3.sm:px-6.py-3.text-left.text-xs.font-medium.text-gray-500.uppercase.tracking-wider
            = t('admin.news_posts.table.created_at')
          %th.px-3.sm:px-6.py-3.text-right.text-xs.font-medium.text-gray-500.uppercase.tracking-wider
            = t('admin.news_posts.table.actions')
      %tbody.bg-white.divide-y.divide-gray-200
        - if @news_posts.empty?
          %tr
            %td.px-3.sm:px-6.py-4.text-center.text-gray-500{colspan: current_user.admin_or_superadmin? ? 7 : 6}
              = t('admin.news_posts.no_posts')
        - else
          - @news_posts.each do |post|
            %tr{class: post.archived? ? 'bg-gray-50' : ''}
              %td.px-3.sm:px-6.py-4
                .text-sm.font-medium.text-gray-900= post.title
                .text-xs.text-gray-500.mt-1
                  - if post.plain_text?
                    = truncate(post.content, length: 100)
                  - elsif post.rich_text?
                    = truncate(post.rich_content.to_plain_text, length: 100)
                  - elsif post.image_only?
                    %span.italic= "[Obraz]"
              %td.px-3.sm:px-6.py-4.whitespace-nowrap
                %span.inline-flex.items-center.px-2.5.py-0.5.rounded-full.text-xs.font-medium.bg-blue-100.text-blue-800
                  - if post.post_type.present?
                    = t("admin.news_posts.types.#{post.post_type}", default: post.post_type.humanize)
                  - else
                    = t('admin.news_posts.types.unknown', default: 'Nieznany')
              - if current_user.admin_or_superadmin?
                %td.px-3.sm:px-6.py-4.whitespace-nowrap
                  - if post.location
                    %span.inline-flex.items-center.px-2.5.py-0.5.rounded-full.text-xs.font-medium.bg-purple-100.text-purple-800
                      = lucide_icon('map-pin', class: 'w-3 h-3 mr-1')
                      = post.location.code
                  - else
                    %span.inline-flex.items-center.px-2.5.py-0.5.rounded-full.text-xs.font-medium.bg-gray-100.text-gray-800
                      = t('admin.news_posts.general')
              %td.px-3.sm:px-6.py-4.whitespace-nowrap.text-sm.text-gray-500
                = post.user.username
              %td.px-3.sm:px-6.py-4.whitespace-nowrap
                .flex.flex-col.gap-1
                  - if post.archived?
                    %span.inline-flex.items-center.px-2.5.py-0.5.rounded-full.text-xs.font-medium.bg-gray-100.text-gray-800
                      = lucide_icon('archive', class: 'w-3 h-3 mr-1')
                      = t('admin.news_posts.status.archived')
                  - elsif post.published?
                    %span.inline-flex.items-center.px-2.5.py-0.5.rounded-full.text-xs.font-medium.bg-green-100.text-green-800
                      = lucide_icon('check-circle', class: 'w-3 h-3 mr-1')
                      = t('admin.news_posts.status.published')
                  - else
                    %span.inline-flex.items-center.px-2.5.py-0.5.rounded-full.text-xs.font-medium.bg-yellow-100.text-yellow-800
                      = lucide_icon('clock', class: 'w-3 h-3 mr-1')
                      = t('admin.news_posts.status.draft')
              %td.px-3.sm:px-6.py-4.whitespace-nowrap.text-sm.text-gray-500
                = l(post.created_at, format: :short)
              %td.px-3.sm:px-6.py-4.whitespace-nowrap.text-right.text-sm.font-medium
                .flex.justify-end.gap-2.flex-wrap
                  = link_to admin_news_post_path(post), class: "text-blue-600 hover:text-blue-900", title: t('admin.news_posts.show') do
                    = lucide_icon('eye', class: 'w-4 h-4')
                  = link_to edit_admin_news_post_path(post), class: "text-[#FA812F] hover:text-[#E87020]", title: t('admin.news_posts.edit') do
                    = lucide_icon('pencil', class: 'w-4 h-4')

                  - unless post.archived?
                    - if post.published?
                      = button_to unpublish_admin_news_post_path(post), method: :patch, class: "text-yellow-600 hover:text-yellow-900", title: t('admin.news_posts.unpublish') do
                        = lucide_icon('x-circle', class: 'w-4 h-4')
                    - else
                      = button_to publish_admin_news_post_path(post), method: :patch, class: "text-green-600 hover:text-green-900", title: t('admin.news_posts.publish') do
                        = lucide_icon('send', class: 'w-4 h-4')

                  - if post.archived?
                    = button_to restore_admin_news_post_path(post), method: :patch, class: "text-blue-600 hover:text-blue-900", title: t('admin.news_posts.restore') do
                      = lucide_icon('archive-restore', class: 'w-4 h-4')
                  - else
                    = button_to archive_admin_news_post_path(post), method: :patch, class: "text-gray-600 hover:text-gray-900", title: t('admin.news_posts.archive') do
                      = lucide_icon('archive', class: 'w-4 h-4')

                  = button_to admin_news_post_path(post), method: :delete, class: "text-red-600 hover:text-red-900", title: t('admin.news_posts.delete'), data: { turbo_confirm: t('admin.news_posts.delete_confirm') } do
                    = lucide_icon('trash-2', class: 'w-4 h-4')

.px-3.sm:px-6.py-4.bg-white.border-t.border-gray-200.flex.justify-center
  = paginate @news_posts